(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};Cable.ConnectionMonitor=function(){function e(e){this.consumer=e,this.visibilityDidChange=t(this.visibilityDidChange,this),this.consumer.subscriptions.add(this),this.start()}var n,i,o;return e.pollInterval={min:3,max:30},e.staleThreshold=6,e.prototype.identifier=Cable.INTERNAL.identifiers.ping,e.prototype.connected=function(){return this.reset(),this.pingedAt=i(),delete this.disconnectedAt},e.prototype.disconnected=function(){return this.disconnectedAt=i()},e.prototype.received=function(){return this.pingedAt=i()},e.prototype.reset=function(){return this.reconnectAttempts=0},e.prototype.start=function(){return this.reset(),delete this.stoppedAt,this.startedAt=i(),this.poll(),document.addEventListener("visibilitychange",this.visibilityDidChange)},e.prototype.stop=function(){return this.stoppedAt=i(),document.removeEventListener("visibilitychange",this.visibilityDidChange)},e.prototype.poll=function(){return setTimeout(function(t){return function(){if(!t.stoppedAt)return t.reconnectIfStale(),t.poll()}}(this),this.getInterval())},e.prototype.getInterval=function(){var t,e,i,o;return o=this.constructor.pollInterval,i=o.min,e=o.max,t=5*Math.log(this.reconnectAttempts+1),1e3*n(t,i,e)},e.prototype.reconnectIfStale=function(){if(this.connectionIsStale()&&(this.reconnectAttempts++,!this.disconnectedRecently()))return this.consumer.connection.reopen()},e.prototype.connectionIsStale=function(){var t;return o(null!=(t=this.pingedAt)?t:this.startedAt)>this.constructor.staleThreshold},e.prototype.disconnectedRecently=function(){return this.disconnectedAt&&o(this.disconnectedAt)<this.constructor.staleThreshold},e.prototype.visibilityDidChange=function(){if("visible"===document.visibilityState)return setTimeout(function(t){return function(){if(t.connectionIsStale()||!t.consumer.connection.isOpen())return t.consumer.connection.reopen()}}(this),200)},e.prototype.toJSON=function(){var t,e;return e=this.getInterval(),t=this.connectionIsStale(),{startedAt:this.startedAt,stoppedAt:this.stoppedAt,pingedAt:this.pingedAt,reconnectAttempts:this.reconnectAttempts,connectionIsStale:t,interval:e}},i=function(){return(new Date).getTime()},o=function(t){return(i()-t)/1e3},n=function(t,e,n){return Math.max(e,Math.min(n,t))},e}()}).call(this);